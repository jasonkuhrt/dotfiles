//
//
//
// Jason's Zed Keymap
//
// ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄
//
//
//
// Reminder to self to try the following things when I have some time:
//
// - cmd-H should toggle between the left dock. Currently it focus project panel.
// - Remove inherited vscode keybinds?
//
// - "cmd-shift-e": "pane::RevealInProjectPanel",
// - if search active, dismiss with / and use ctrl-/ to force send that char (like terminal solution)
// - search thing reminder: https://discord.com/channels/869392257814519848/1250470360139300934/1378120458095820891
// - on cmd-s also perform a format on the file (b/c if no change then format-on-save is not triggered since no save is actually performed)
[
  //
  //
  //
  //
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ • Outline
  //
  //

  {
    "context": "OutlinePanel && not_editing",
    "bindings": {
      "/": "outline_panel::ToggleFocus"
    }
  },

  //
  //
  //
  //
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ • Docks & Panels
  //
  //
  //

  //
  //
  //
  // ━━━━━━━━━━━━━━ • Cycle Dock Left
  //
  //

  {
    "context": "Workspace > Dock > ProjectPanel",
    "bindings": {
      "cmd-{": "collab_panel::ToggleFocus",
      "cmd-}": "git_panel::ToggleFocus"
    }
  },
  {
    "context": "Workspace > Dock > GitPanel",
    "bindings": {
      "cmd-{": "project_panel::ToggleFocus",
      "cmd-}": "outline_panel::ToggleFocus"
    }
  },
  {
    "context": "Workspace > Dock > OutlinePanel",
    "bindings": {
      "cmd-{": "git_panel::ToggleFocus",
      "cmd-}": "project_panel::ToggleFocus"
      // "cmd-}": "collab_panel::ToggleFocus" // Omit Collab From Cycle. Not using currently.
    }
  },
  {
    "context": "Workspace > Dock > CollabPanel",
    "bindings": {
      "cmd-{": "outline_panel::ToggleFocus",
      "cmd-}": "project_panel::ToggleFocus"
    }
  },

  //
  //
  //
  // ━━━━━━━━━━━━━━ • Toggle Docks
  //
  //

  {
    "bindings": {
      "cmd-l": "workspace::ToggleRightDock",
      "cmd-L": "agent::ToggleFocus",
      "cmd-h": "workspace::ToggleLeftDock",
      "cmd-j": "workspace::ToggleBottomDock",
      "cmd-H": "project_panel::ToggleFocus"
    }
  },
  {
    "context": "vim_mode == normal || (vim_mode == helix_normal && !menu) || ChangesList || EmptyPane || SharedScreen || MarkdownPreview || KeyContextView || Welcome || ProjectPanel || GitPanel || Diagnostics || (Terminal && vi_mode)",
    "bindings": {
      "space p P": "workspace::CloseAllDocks",
      "space p g": "git_panel::ToggleFocus",
      "space p t": "terminal_panel::ToggleFocus",
      "space p p": "project_panel::ToggleFocus",
      "space p o": "outline_panel::ToggleFocus",
      "space p c": "collab_panel::ToggleFocus",
      "space p e": "diagnostics::Deploy" // "e" aligns with m e
    }
  },

  //
  //
  //
  //
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ • Palettes
  //
  //

  // todo: try working with vi mode instead
  // //
  // // ─ Special case for Terminal
  // //
  // //    I rarely type ; in terminal. With this I can launch the
  // //    command palette from there as well as I do from the editor.
  // //
  // {
  //   "context": "Terminal",
  //   "bindings": {
  //     ";": "command_palette::Toggle",
  //     "cmd-;": ["terminal::SendText", ";"]
  //   }
  // },

  //
  // ─ General
  //

  {
    "context": "vim_mode == normal || (vim_mode == helix_normal && !menu) || ChangesList || EmptyPane || SharedScreen || MarkdownPreview || KeyContextView || Welcome || ProjectPanel || GitPanel || Diagnostics || (Terminal && vi_mode)",
    "bindings": {
      ";": "command_palette::Toggle",
      "space L": "project_symbols::Toggle",
      "space l": "outline::Toggle",
      "space k": "file_finder::Toggle",
      "space j": "task::Spawn",
      "space o": ["projects::OpenRecent", { "create_new_window": true }]
      // "cmd-k": "file_finder::Toggle"
    }
  },

  //
  // ─ todo: not sure I find this one useful. Will need to master <,> thingy
  //

  {
    "context": "vim_mode == visual",
    "bindings": {
      ";": "vim::VisualCommand"
    }
  },

  //
  // ─ Standard macOS open hotkey (cmd-o) uses palette
  //

  {
    // Has to be empty context for buggy reason?
    // @see https://github.com/zed-industries/zed/issues/21358#issuecomment-2927946680
    // "context": "Workspace",
    // "context": "",
    "bindings": {
      "cmd-s": ["workspace::SendKeystrokes", "cmd-s cmd-shift-i"],
      "cmd-o": ["workspace::SendKeystrokes", "space o"],
      "alt-cmd-o": "workspace::Open"
    }
  },

  //
  //
  //
  //
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ • Terminal Vim
  //
  //

  {
    "context": "Terminal && !(Terminal && vi_mode)", // Faux Terminal Insert Mode
    "bindings": {
      // Doesn't seem to work well
      // @see https://github.com/zed-industries/zed/issues/16286
      // @see https://discord.com/channels/869392257814519848/1250470360139300934/1379106906186190979
      // "escape": "terminal::ToggleViMode",
      // "k j": "terminal::ToggleViMode"
      // Support multi-line input for Claude Code in terminal
      "shift-enter": ["terminal::SendText", "\n"]
    }
  },

  //
  //
  //
  //
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ • Panes & Docks
  //
  //
  //

  //
  //
  //
  // ━━━━━━━━━━━━━━ • Consistent Pane/Dock Navigation
  //
  //

  {
    "context": "(Editor && vim_mode != insert && vim_mode != visual) || Dock || Pane || GitPanel || ProjectPanel || CollabPanel || OutlinePanel || ChatPanel || DebugPanel",
    "bindings": {
      // Another approach.
      // Allow getting _out_ of e.g. terminal pane where we have no <space _> control
      // We can be modal by holding ctrl and then navigate quickly.
      // TODO: delete the space w approach in favour of this?
      "ctrl-k": "workspace::ActivatePaneUp",
      "ctrl-l": "workspace::ActivatePaneRight",
      "ctrl-j": "workspace::ActivatePaneDown",
      "ctrl-h": "workspace::ActivatePaneLeft"
    }
  },
  {
    "context": "vim_mode == normal || (Terminal && vi_mode) || GitPanel || ProjectPanel || CollabPanel || OutlinePanel || ChatPanel || VimControl || EmptyPane || SharedScreen || MarkdownPreview || KeyContextView || DebugPanel || Diagnostics",
    "bindings": {
      "space w k": "workspace::ActivatePaneUp",
      "space w l": "workspace::ActivatePaneRight",
      "space w j": "workspace::ActivatePaneDown",
      "space w h": "workspace::ActivatePaneLeft",

      "space w '": "pane::CloseAllItems",
      "space w \"": "workspace::CloseAllItemsAndPanes",

      "space w s": "pane::SplitVertical",
      "space w a": "pane::SplitHorizontal",
      "space w K": "pane::SplitUp",
      "space w L": "pane::SplitRight",
      "space w J": "pane::SplitDown",
      "space w H": "pane::SplitLeft",

      "space w p": "pane::TogglePinTab",

      //
      //
      //
      // ━━━━━━━━━━━━━━ • Configuration
      //
      //

      ", ,": "zed::OpenSettings",
      ", k": "zed::OpenKeymap",
      ", K": "zed::OpenDefaultKeymap",
      ", s": "snippets::ConfigureSnippets",
      ", t": "zed::OpenTasks",
      // ━ Toggle
      ", e": "editor::ToggleInlineDiagnostics", // "e" aligns with m e
      ", v": "editor::ToggleInlineValues",
      ", w": "diagnostics::ToggleWarnings", // "w" is close to "e" ...
      ", space": "editor::ToggleSoftWrap",
      ", g": ["task::Spawn", { "task_name": "toggle: chore files" }], // gitignore visibility
      // ━ Reload
      ", R": "workspace::Reload",
      ", r": "editor::RestartLanguageServer"
    }
  },

  //
  //
  //
  // ━━━━━━━━━━━━━━ • Let ctrl-' exit side panels
  //
  //

  {
    "context": "Terminal",
    "bindings": { "ctrl-'": "terminal_panel::ToggleFocus" }
  },
  {
    "context": "AgentPanel",
    "bindings": { "ctrl-'": "agent::ToggleFocus" }
  },

  //
  //
  //
  //
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ • Menus
  //
  //

  {
    "context": "Picker > Editor",
    "bindings": {
      "ctrl-j": "menu::SelectNext",
      "ctrl-k": "menu::SelectPrevious"
    }
  },
  {
    "context": "Pane > (Editor && showing_completions)",
    "bindings": {
      "ctrl-j": "editor::ContextMenuNext",
      "ctrl-k": "editor::ContextMenuPrevious"
    }
  },
  //
  //
  //
  //
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ • Git
  //
  //
  {
    "context": "vim_mode == normal || (Terminal && vi_mode) || GitPanel || ProjectPanel || CollabPanel || OutlinePanel || ChatPanel || VimControl || EmptyPane || SharedScreen || MarkdownPreview || KeyContextView || DebugPanel || Diagnostics",
    "bindings": {
      // ━ NAVIGATE
      "fn-_gj1": "editor::GoToHunk",
      "g j": ["workspace::SendKeystrokes", "fn-_gj1 g Z"],
      "fn-_gk1": "editor::GoToPreviousHunk",
      "g k": ["workspace::SendKeystrokes", "fn-_gj1 g Z"],
      "g b": "git::Switch", // branch palette
      "g w": "git_panel::ToggleFocus",
      "g d": "git::Diff", // opens panel
      // ━ SEE
      "g o": "editor::ToggleSelectedDiffHunks", // ala "z o" folding
      "g O": "editor::ExpandAllDiffHunks",
      // ━ REVIEW
      "g a": "git::ToggleStaged", // "a" for add
      "g A": "git::StageAll",
      "g u": "git::Restore", // "u" for undo
      "g U": "git::RestoreFile", // "u" for undo
      // ━ COMMIT
      "g c": "git::Commit",
      "g p": "git::Push", // todo: once Zed has a git::sync command then use that here
      "g P": "git::ForcePush"
    }
  },
  {
    // todo: having j/k nav also open the file as it passes over it?
    "context": "GitPanel && ChangesList",
    "bindings": {
      // ━ Motion
      "K": "menu::SelectFirst",
      "J": "menu::SelectLast",
      // ━ Stage
      // Vertical motion for nav while horizontal motion for stage
      "l": "git::StageFile",
      "h": "git::UnstageFile",
      // Alt stage key to be consistent with other bindings, also offers "toggle"
      "a": "git::ToggleStaged",
      // ━ View
      "o": "menu::SecondaryConfirm", // open file
      "O": "menu::Confirm", // open file in diff panel
      // ━ Restore
      "d": ["git::RestoreFile", { "skip_prompt": false }],
      "D": ["git::RestoreFile", { "skip_prompt": true }]
    }
  },

  //
  //
  //
  //
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ • AI
  //
  //

  {
    "context": "Editor && (vim_mode == normal || vim_mode == visual)",
    "bindings": {
      "space r s": [
        "assistant::InlineAssist",
        { "prompt": "convert switch-case statement" }
      ]
    }
  },
  {
    "context": "Editor && (vim_mode == normal || vim_mode == visual)",
    "bindings": {
      "space r t": [
        "assistant::InlineAssist",
        { "prompt": "convert to nested ternary" }
      ]
    }
  },
  {
    "context": "Editor && edit_prediction",
    "bindings": {
      "shift-enter": "editor::AcceptEditPrediction"
    }
  },
  {
    "context": "Editor && edit_prediction_conflict",
    "bindings": {
      "shift-enter": "editor::AcceptEditPrediction"
    }
  },
  //
  //
  //
  //
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ • Movement
  //
  //
  //
  {
    "context": "Editor && (vim_mode == normal || vim_mode == visual)",
    "bindings": {
      "cmd-K": "vim::StartOfDocument",
      "K": "vim::ScrollUp",
      "L": "vim::EndOfLine",
      "J": "vim::ScrollDown",
      "cmd-J": "vim::EndOfDocument",
      "u": "vim::MoveToPrevious",
      "H": "vim::StartOfLine",
      "[": "pane::GoBack",
      "]": "pane::GoForward"
      // "ctrl-k": "vim::PageUp",
      // "ctrl-j": "vim::PageDown"
    }
  },
  //
  //
  //
  //
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ • Search
  //
  //
  //
  {
    "context": "Editor",
    "bindings": {
      "cmd-?": "project_search::SearchInNew"
      // "alt-cmd-u": "project_search::SearchInNew"
    }
  },
  // Vertical centre on search next
  {
    "context": "VimControl && !menu",
    "bindings": {
      "n": ["workspace::SendKeystrokes", "n z z"],
      "N": ["workspace::SendKeystrokes", "N z z"]
    }
  },
  {
    "context": "Editor && vim_mode == normal",
    "bindings": {
      "?": "buffer_search::DeployReplace",
      "f": "vim::PushSneak",
      "F": "vim::PushSneakBackward" // todo: I probably will never use this, make better use of key?
    }
  },
  //
  //
  //
  //
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ • Organize Me Plz
  //
  //
  //
  {
    "context": "Workspace",
    "bindings": {
      "ctrl-'": ["workspace::SendKeystrokes", "escape"]
    }
  },
  {
    "context": "Editor && vim_mode == visual",
    "bindings": {
      "q": "vim::NormalBefore",
      "cmd-k": "editor::DuplicateLineUp",
      "cmd-j": "editor::DuplicateLineDown",
      "v": "vim::SelectLargerSyntaxNode",
      "}": "vim::SelectLargerSyntaxNode",
      "{": "vim::SelectSmallerSyntaxNode"
    }
  },
  {
    "context": "Editor && vim_mode == insert",
    "bindings": {
      "k j": "vim::NormalBefore",
      "shift-backspace": "vim::DeleteRight"
    }
  },
  {
    "context": "Editor && vim_mode == normal",
    "bindings": {
      "V": "editor::SelectEnclosingSymbol"
      // "?": "pane::DeploySearch",
    }
  },
  {
    "context": "Editor && (vim_mode == normal || vim_mode == visual)",
    "bindings": {
      "U": "editor::Redo",
      "u": "vim::Undo",
      "r": "editor::Rename",
      "q": "editor::GoToDefinitionSplit",
      "m d": "editor::GoToDefinitionSplit",
      "m D": "editor::GoToDefinition",
      "m t": "editor::GoToTypeDefinitionSplit",
      "m T": "editor::GoToTypeDefinition",
      "m r": "editor::FindAllReferences",
      "m j": "editor::GoToDiagnostic",
      "m K": "editor::GoToPreviousDiagnostic",
      "space f": "workspace::ToggleCenteredLayout",
      "space z": "workspace::ToggleZoom",
      ///
      // ─ Unsure about these ones
      //
      "w": "vim::Matching"
    }
  },
  {
    "context": "vim_mode == normal",
    "bindings": {
      "space .": "editor::ToggleCodeActions",
      "z o": "editor::ToggleFold"
    }
  },
  // {
  //   "context": "Editor && vim_mode == operator && vim_operator == d",
  //   "bindings": {
  //     "L": "vim::DeleteToEndOfLine"
  //   }
  // },
  //
  //
  //
  //
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ • Toggle
  //
  //
  //
  {
    "context": "Editor && (vim_mode == normal || vim_mode == visual)",
    "bindings": {
      "space t h": "editor::ToggleInlayHints"
    }
  },
  //
  //
  //
  //
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ • Project Panel
  //
  //

  {
    "context": "ProjectPanel && not_editing",
    "use_key_equivalents": true,
    "bindings": {
      "ctrl-k": "project_panel::SelectPrevDirectory",
      "ctrl-j": "project_panel::SelectNextDirectory",
      "K": "menu::SelectFirst",
      "H": "project_panel::CollapseAllEntries",
      "J": "menu::SelectLast",
      "N": "project_panel::NewDirectory",
      "r": "project_panel::Rename",
      "n": "project_panel::NewFile",
      "d": ["project_panel::Trash", { "skip_prompt": true }], // No prompt since we can always restore from macOS Trash
      "delete": ["project_panel::Trash", { "skip_prompt": true }],
      "c": "project_panel::Copy",
      "p": "project_panel::Paste",
      "/": "project_panel::NewSearchInDirectory",
      "cmd-enter": "project_panel::OpenWithSystem",
      "shift-enter": "project_panel::RevealInFileManager"
      // defaults
      // "cmd-d": "project_panel::Duplicate",
      // "cmd-alt-c": "workspace::CopyPath",
      // "alt-cmd-shift-c": "workspace::CopyRelativePath",
    }
  },

  //
  //
  //
  //
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ • Zed Issues
  //
  //
  {
    "context": "Workspace > Dock > AgentPanel",
    "bindings": {
      "alt-cmd-B1_": ["workspace::SendKeystrokes", "cmd-c"],
      "alt-cmd-B2_": [
        "zed::OpenBrowser",
        {
          "url": "https://github.com/zed-industries/zed/issues/new?template=10_bug_report.yml"
        }
      ],
      "alt-cmd-B": ["workspace::SendKeystrokes", "alt-cmd-B1_ alt-cmd-B2_"]
    }
  }
]
